<?xml version="1.0"?>
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="http://community.rti.com/schema/5.1.0/rti_dds_profiles.xsd" version="5.1.0">

    <!-- Qos Library -->
    <qos_library name="QosLibrary">
        <qos_profile name="DefaultProfile" is_default_qos="true">
            <participant_qos>
                <discovery>
                    <initial_peers>
                        <element>shmem://</element>
                    </initial_peers>
                    <multicast_receive_addresses/>
                </discovery>
                <!-- Disable shared memory transport to avoid macOS configuration issues -->
                <transport_builtin>
                    <mask>UDPV4 | SHMEM</mask>
                </transport_builtin>
                <property>
                    <value>
                        <!-- Use smaller shared memory settings for macOS -->
                        <element>
                            <name>dds.transport.shmem.builtin.receive_buffer_size</name>
                            <value>65536</value>
                        </element>
                        <element>
                            <name>dds.transport.shmem.builtin.received_message_count_max</name>
                            <value>32</value>
                        </element>
                    </value>
                </property>
            </participant_qos>
            <datawriter_qos>
                <reliability>
                    <kind>RELIABLE_RELIABILITY_QOS</kind>
                </reliability>
                <history>
                    <kind>KEEP_ALL_HISTORY_QOS</kind>
                </history>
                <durability>
                    <kind>TRANSIENT_LOCAL_DURABILITY_QOS</kind>
                </durability>
            </datawriter_qos>
            <datareader_qos>
                <reliability>
                    <kind>RELIABLE_RELIABILITY_QOS</kind>
                </reliability>
                <history>
                    <kind>KEEP_ALL_HISTORY_QOS</kind>
                </history>
                <durability>
                    <kind>TRANSIENT_LOCAL_DURABILITY_QOS</kind>
                </durability>
            </datareader_qos>
        </qos_profile>
    </qos_library>

    <!-- types -->
    <types>
        <struct name="RequestType">
          <member name="request_id" type="long" key="true"/>
          <member name="request_data" type="string" stringMaxLength="256"/>
        </struct>
        <struct name="ReplyType">
          <member name="reply_id" type="long" key="true"/>
          <member name="reply_data" type="string" stringMaxLength="256"/>
        </struct>
    </types>

    <!-- Domain Library -->
    <domain_library name="MyDomainLibrary">
        <domain name="MyDomain" domain_id="3">
            <register_type name="RequestType" type_ref="RequestType" />
            <register_type name="ReplyType" type_ref="ReplyType" />
            <topic name="RequestTopic" register_type_ref="RequestType"/>
            <topic name="ReplyTopic" register_type_ref="ReplyType"/>
        </domain>
    </domain_library>

    <!-- Participant library -->
    <domain_participant_library name="MyParticipantLibrary">
        <domain_participant name="Requester" domain_ref="MyDomainLibrary::MyDomain">
            <publisher name="RequestPublisher">
                <data_writer name="RequestWriter" topic_ref="RequestTopic" />
            </publisher>
            <subscriber name="ReplySubscriber">
                <data_reader name="ReplyReader" topic_ref="ReplyTopic" />
            </subscriber>
        </domain_participant>
        <domain_participant name="Replier" domain_ref="MyDomainLibrary::MyDomain">
            <publisher name="ReplyPublisher">
                <data_writer name="ReplyWriter" topic_ref="ReplyTopic" />
            </publisher>
            <subscriber name="RequestSubscriber">
                <data_reader name="RequestReader" topic_ref="RequestTopic" />
            </subscriber>
        </domain_participant>
    </domain_participant_library>
</dds>
